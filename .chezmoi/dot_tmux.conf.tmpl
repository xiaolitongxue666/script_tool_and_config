{{- if or (eq .chezmoi.os "linux") (eq .chezmoi.os "darwin") -}}
# Tmux 统一配置文件
# 配置文件位置: ~/.config/tmux/tmux.conf 或 ~/.tmux.conf
# 使用 Catppuccin Mocha 主题

# ============================================
# 基础配置
# ============================================

# 设置前缀键为 Ctrl+b
unbind C-b
set-option -g prefix C-b
bind-key C-b send-prefix

# 重新加载配置文件
bind r source-file ~/.tmux.conf \; display "配置文件已重新加载！"

# 设置窗口和面板索引从 1 开始
set -g base-index 1
setw -g pane-base-index 1

# 启用鼠标支持
set -g mouse on

# 滚动历史记录
set -g history-limit 50000

# 显示消息时间（毫秒）
set -g display-time 4000

# 降低转义时间，提高响应速度（从 500ms 到 50ms）
set -s escape-time 50

# ============================================
# 窗口和面板管理
# ============================================

# 设置窗口分割快捷键
bind | split-window -h
bind - split-window -v
unbind '"'
unbind %

# 快速切换面板（使用 h/j/k/l）
bind h select-pane -L
bind j select-pane -D
bind k select-pane -U
bind l select-pane -R

# 调整面板大小（使用 H/J/K/L，支持重复按键）
bind -r H resize-pane -L 5
bind -r J resize-pane -D 5
bind -r K resize-pane -U 5
bind -r L resize-pane -R 5

# 调整面板大小（使用 I/K/J/L，大写字母）
bind-key I resize-pane -U 10
bind-key K resize-pane -D 10
bind-key J resize-pane -L 10
bind-key L resize-pane -R 10

# 选择面板（使用 i/k/j/l，小写字母）
bind-key i select-pane -U
bind-key k select-pane -D
bind-key j select-pane -L
bind-key l select-pane -R

# 设置窗口切换快捷键
bind -r C-h select-window -t :-
bind -r C-l select-window -t :+

# 设置窗口和面板重命名
setw -g automatic-rename on
set -g renumber-windows on

# 拖拽重新排序窗口
bind-key -n MouseDrag1Status swap-window -t=

# ============================================
# 终端和颜色配置
# ============================================

# 设置默认 shell 为 zsh
# 自动检测 zsh 路径（支持 macOS 和 Linux）
# 优先级：1. Homebrew zsh (Apple Silicon: /opt/homebrew) 2. Homebrew zsh (Intel: /usr/local) 3. 系统 zsh (/usr/bin, /bin) 4. 通过 command -v 查找
# 使用 run-shell 在配置加载时动态设置，确保跨平台兼容性
run-shell 'ZSH_PATH=""; if [ -f /opt/homebrew/bin/zsh ]; then ZSH_PATH="/opt/homebrew/bin/zsh"; elif [ -f /usr/local/bin/zsh ]; then ZSH_PATH="/usr/local/bin/zsh"; elif [ -f /usr/bin/zsh ]; then ZSH_PATH="/usr/bin/zsh"; elif [ -f /bin/zsh ]; then ZSH_PATH="/bin/zsh"; else ZSH_PATH=$(command -v zsh 2>/dev/null); fi; [ -n "$ZSH_PATH" ] && tmux set-option -g default-shell "$ZSH_PATH"'

# 设置终端类型（支持真彩色和斜体）
# 如果使用 Alacritty 终端，取消注释下面一行
# set -g default-terminal "alacritty"
set -g default-terminal "screen-256color"
set -ga terminal-overrides ",xterm-256color:Tc"

# ============================================
# Catppuccin 主题配置
# ============================================

# 设置 Catppuccin 主题 flavor 为 Mocha
set -g @catppuccin_flavor 'mocha'

# 窗口状态样式（可选，使用圆角样式）
set -g @catppuccin_window_status_style "rounded"

# 加载 Catppuccin 主题（手动安装方式）
# 主题路径: ~/.config/tmux/plugins/catppuccin/tmux/catppuccin.tmux
run '~/.config/tmux/plugins/catppuccin/tmux/catppuccin.tmux'

# ============================================
# 状态栏配置（Catppuccin 主题会覆盖这些设置，但保留作为备用）
# ============================================

# 设置状态栏位置
set -g status-position bottom

# 状态栏长度配置（Catppuccin 主题会使用这些设置）
set -g status-right-length 100
set -g status-left-length 100

# 状态栏左侧（可选，Catppuccin 主题默认为空）
set -g status-left ""

# 状态栏右侧（可选，添加一些模块）
# 注意：这些模块需要安装对应的插件，如果不需要可以注释掉
# set -g status-right "#{E:@catppuccin_status_application}"
# set -agF status-right "#{E:@catppuccin_status_cpu}"
# set -ag status-right "#{E:@catppuccin_status_session}"
# set -ag status-right "#{E:@catppuccin_status_uptime}"
# set -agF status-right "#{E:@catppuccin_status_battery}"

# ============================================
# 剪贴板集成（Linux，需要 xclip）
# ============================================
# 注意：macOS 使用 pbcopy/pbpaste，Linux 使用 xclip
# 安装 xclip: sudo apt-get install xclip 或 sudo pacman -S xclip

# Ctrl+c 复制到剪贴板
bind C-c run-shell "tmux save-buffer - | xclip -i -sel clipboard 2>/dev/null || tmux save-buffer - | pbcopy 2>/dev/null || true"

# Ctrl+v 从剪贴板粘贴
bind C-v run-shell "tmux set-buffer \"$(xclip -o -sel clipboard 2>/dev/null || pbpaste 2>/dev/null || echo '')\"; tmux paste-buffer"

# 鼠标选择后自动复制到剪贴板
unbind -n -Tcopy-mode-vi MouseDragEnd1Pane
bind -Tcopy-mode-vi MouseDragEnd1Pane send -X copy-selection-and-cancel\; run-shell "tmux save-buffer - | xclip -i -sel clipboard 2>/dev/null || tmux save-buffer - | pbcopy 2>/dev/null || true"

# 中键点击从剪贴板粘贴
unbind-key MouseDown2Pane
bind-key -n MouseDown2Pane run-shell "X=\$(xclip -o -sel clipboard 2>/dev/null || pbpaste 2>/dev/null || echo ''); tmux set-buffer \"\$X\"; tmux paste-buffer -p; tmux display-message 'pasted!'"

# ============================================
# TPM (Tmux Plugin Manager) 插件（可选，保留兼容性）
# ============================================
# 安装 TPM: git clone https://github.com/tmux-plugins/tpm ~/.tmux/plugins/tpm

# 插件列表（如果需要使用 TPM 管理其他插件）
# set -g @plugin 'tmux-plugins/tpm'
# set -g @plugin 'tmux-plugins/tmux-sensible'
# set -g @plugin 'tmux-plugins/tmux-resurrect'
# set -g @plugin 'tmux-plugins/tmux-yank'

# tmux-resurrect 设置
# set -g @resurrect-strategy-vim 'session'

# 初始化 TMUX 插件管理器（如果使用 TPM）
# 注意：由于使用 Catppuccin 手动安装方式，TPM 是可选的
# 如果需要使用 TPM，取消注释下面一行（修复后的语法）：
# run '~/.tmux/plugins/tpm/tpm'
{{- end -}}

