# SSH 配置（由 chezmoi 管理）
# GitHub 走 443 端口，可选经代理（Clash 等）；参考: clash代理下git-ssh走443配置.md

# --- GitHub：ssh.github.com:443，经代理时使用 ProxyCommand ---
# macOS：ProxyCommand 必须写 connect 的绝对路径，否则 GUI（Obsidian、Finder 等）因 PATH 不含 /usr/local/bin 会报 exec: connect: not found
# -H = HTTP 代理（如 Clash），-S = SOCKS；由 macos_proxy_connect_opt 控制
Host github.com
    HostName ssh.github.com
    Port 443
    User git
    IdentityFile {{ .identity_file | default "~/.ssh/id_rsa" }}
{{- if eq .chezmoi.os "windows" }}
    ProxyCommand "{{ .windows_git_connect_path | default "C:/Program Files/Git/mingw64/bin/connect.exe" }}" -S {{ .proxy_host | default "127.0.0.1" }}:{{ .proxy_port | default "7890" }} %h %p
{{- else if eq .chezmoi.os "darwin" }}
    ProxyCommand "{{ .macos_connect_path | default "/opt/homebrew/bin/connect" }}" {{ .macos_proxy_connect_opt | default "-S" }} {{ .proxy_host | default "127.0.0.1" }}:{{ .proxy_port | default "7890" }} %h %p
{{- else if eq .chezmoi.os "linux" }}
    ProxyCommand nc -X connect -x {{ .proxy_host | default "127.0.0.1" }}:{{ .proxy_port | default "7890" }} %h %p
{{- end }}

# 其他 Host（如内网 Git 服务器）请在本机或 lazyssh 中单独添加
# --- 其他 Host 默认 ---
Host *
    ForwardAgent yes
