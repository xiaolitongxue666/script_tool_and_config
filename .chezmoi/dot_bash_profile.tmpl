{{- if eq .chezmoi.os "darwin" -}}
# Bash Profile 配置文件（macOS）
# macOS 的 Terminal.app 在登录 shell 中只读取 .bash_profile
# 注意：此文件仅适用于 macOS，Linux 和 Windows 使用 .bashrc

# ============================================
# 系统检测
# ============================================
if [[ "$OSTYPE" == "darwin"* ]]; then
    OS="macos"
else
    OS="unknown"
fi

# ============================================
# 通用配置（所有平台）
# ============================================

# ============================================
# 代理配置（统一配置，参考 Git Bash）
# ============================================
# 默认代理地址（可通过环境变量 PROXY 覆盖）
PROXY_URL="${PROXY:-{{ env "http_proxy" | default "http://127.0.0.1:7890" }}}"

# 代理控制别名（同时设置大小写环境变量，确保所有工具都能识别）
# h_proxy: 快速启用代理
alias h_proxy='export http_proxy='"$PROXY_URL"'; export https_proxy='"$PROXY_URL"'; export HTTP_PROXY='"$PROXY_URL"'; export HTTPS_PROXY='"$PROXY_URL"'; export all_proxy='"$PROXY_URL"'; export ALL_PROXY='"$PROXY_URL"'; echo "代理已启用: $PROXY_URL"'
# unset_h: 关闭代理（清除所有代理环境变量）
alias unset_h='unset http_proxy; unset https_proxy; unset HTTP_PROXY; unset HTTPS_PROXY; unset all_proxy; unset ALL_PROXY; echo "代理已关闭"'

# 默认启用代理（可选，取消注释以自动启用）
# h_proxy

# Bat instead cat
if command -v bat &> /dev/null; then
    alias cat='bat'
fi

# ============================================
# macOS 特定配置
# ============================================
if [[ "$OS" == "macos" ]]; then
    # 添加用户私有 shell 路径
    export PATH=$PATH:/Users/liyong/Code/Tools/Shells/BashTools

    # SDKMAN（必须在文件末尾）
    export SDKMAN_DIR="/Users/liyong/.sdkman"
    [[ -s "/Users/liyong/.sdkman/bin/sdkman-init.sh" ]] && source "/Users/liyong/.sdkman/bin/sdkman-init.sh"

    # 路径配置
    export PATH="/Applications/Postgres.app/Contents/Versions/latest/bin:$PATH"
    export PATH="/Users/liyong/Library/Python/2.7/bin:$PATH"
    export PATH=$PATH':/path/to/add'
    export PATH="/usr/local/bin:$PATH"
    export PATH="/usr/local/opt/make/libexec/gnubin:$PATH"

    # GEM 配置
    export GEM_HOME=$HOME/.gem
    export GEM_PATH=$HOME/.gem

    # fnm (Fast Node Manager) - Node.js 版本管理
    # 参考: https://github.com/Schniz/fnm
    # fnm 会自动处理 Node 版本管理和 .node-version/.nvmrc 文件的自动切换
    if [ -d "{{ .chezmoi.homeDir }}/.local/share/fnm" ]; then
        export PATH="{{ .chezmoi.homeDir }}/.local/share/fnm:$PATH"
        if command -v fnm >/dev/null 2>&1; then
            eval "$(fnm env --shell=bash --use-on-cd)"
            if [ -f "$HOME/.node-version" ]; then
                NODE_VERSION=$(cat "$HOME/.node-version" 2>/dev/null | tr -d '\n\r' | sed 's/^v//')
                if [ -n "$NODE_VERSION" ]; then
                    fnm use "$NODE_VERSION" 2>/dev/null || true
                fi
            fi
        fi
    elif [ -d "{{ .chezmoi.homeDir }}/.fnm" ]; then
        export PATH="{{ .chezmoi.homeDir }}/.fnm:$PATH"
        if command -v fnm >/dev/null 2>&1; then
            eval "$(fnm env --shell=bash --use-on-cd)"
            if [ -f "$HOME/.node-version" ]; then
                NODE_VERSION=$(cat "$HOME/.node-version" 2>/dev/null | tr -d '\n\r' | sed 's/^v//')
                if [ -n "$NODE_VERSION" ]; then
                    fnm use "$NODE_VERSION" 2>/dev/null || true
                fi
            fi
        fi
    fi

    # Cargo
    if [ -f "$HOME/.cargo/env" ]; then
        . "$HOME/.cargo/env"
    fi
fi

# ============================================
# 加载 .bashrc（如果存在）
# ============================================
# macOS 的 Terminal.app 在非登录 shell 中会读取 .bashrc
# 但为了保持一致性，我们在这里也加载它（如果存在）
if [ -f ~/.bashrc ]; then
    source ~/.bashrc
fi
{{- end -}}

